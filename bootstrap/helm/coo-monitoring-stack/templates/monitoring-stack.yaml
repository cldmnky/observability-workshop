apiVersion: monitoring.rhobs/v1alpha1
kind: MonitoringStack
metadata:
  name: {{ .Values.monitoringStack.name }}
  namespace: {{ .Values.monitoringStack.namespace }}
  annotations:
    argocd.argoproj.io/sync-wave: "3"
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
spec:
  logLevel: {{ .Values.monitoringStack.logLevel }}
  retention: {{ .Values.monitoringStack.retention }}
  
  # Resource selector - automatically discovers ServiceMonitors with matching labels
  resourceSelector:
    matchLabels:
      {{- toYaml .Values.monitoringStack.resourceSelector.matchLabels | nindent 6 }}
  
  # Global resources for all monitoring stack pods
  {{- if .Values.monitoringStack.resources }}
  resources:
    {{- toYaml .Values.monitoringStack.resources | nindent 4 }}
  {{- end }}
  
  # Prometheus configuration
  prometheusConfig:
    replicas: {{ .Values.monitoringStack.prometheus.replicas }}
  
  # Alertmanager configuration
  alertmanagerConfig:
    replicas: {{ .Values.monitoringStack.alertmanager.replicas }}

