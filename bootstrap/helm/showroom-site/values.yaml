# Namespace Configuration
namespace: showroom-workshop

# Build Configuration
build:
  # Name of the Build resource
  name: showroom-site-build
  # Git source configuration
  source:
    type: Git
    git:
      url: https://github.com/cldmnky/observability-workshop.git
      revision: main
    contextDir: .
  # Build strategy
  strategy:
    name: buildah
    kind: ClusterBuildStrategy
  # Output image configuration
  output:
    # Use internal OpenShift registry
    image: image-registry.openshift-image-registry.svc:5000/showroom-workshop/showroom-site:latest
  # Containerfile location
  dockerfile: Containerfile
  # Trigger builds automatically on changes
  retention:
    # Keep last 5 successful builds
    succeededLimit: 5
    # Keep last 2 failed builds
    failedLimit: 2

# Deployment Configuration
deployment:
  name: showroom-site
  replicas: 1
  image:
    # Pull policy
    pullPolicy: Always
  # Resource limits and requests
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  # Port configuration
  port: 8080

# Multi-User Workshop Configuration
multiUser:
  # Enable multi-user support with OAuth and user-specific data
  enabled: true
  # User data ConfigMap (will be created from users section below)
  userDataConfigMap: workshop-users
  # User Info API sidecar configuration
  userInfoAPI:
    enabled: true
    image: image-registry.openshift-image-registry.svc:5000/showroom-workshop/user-info-api:latest
    port: 8081
    resources:
      limits:
        cpu: 100m
        memory: 128Mi
      requests:
        cpu: 50m
        memory: 64Mi
  # OAuth Proxy configuration
  oauthProxy:
    enabled: true
    port: 8443
    resources:
      limits:
        cpu: 100m
        memory: 128Mi
      requests:
        cpu: 50m
        memory: 64Mi

# Workshop Users
# Add your workshop users here - will be loaded into ConfigMap
users:
  user1:
    console_url: "https://console-openshift-console.apps.cluster.example.com"
    password: "changeme"
    login_command: "oc login --insecure-skip-tls-verify=false -u user1 -p changeme https://api.cluster.example.com:6443"
    openshift_cluster_ingress_domain: "apps.cluster.example.com"
  # user2:
  #   console_url: "https://console-openshift-console.apps.cluster.example.com"
  #   password: "changeme"
  #   login_command: "oc login --insecure-skip-tls-verify=false -u user2 -p changeme https://api.cluster.example.com:6443"
  #   openshift_cluster_ingress_domain: "apps.cluster.example.com"

# Service Configuration
service:
  name: showroom-site
  type: ClusterIP
  port: 8080
  targetPort: 8080

# Route Configuration
route:
  name: showroom-site
  # TLS configuration
  tls:
    enabled: true
    termination: reencrypt
    insecureEdgeTerminationPolicy: Redirect
  # OAuth annotations (when multiUser.oauthProxy.enabled)
  # Custom hostname (optional, leave empty for auto-generated)
  host: ""
  # Path (optional)
  path: "/"

# BuildRun Configuration
buildRun:
  # Enable automatic initial build via Job
  enabled: true
  # Name of the BuildRun
  name: showroom-site-buildrun-initial
  # Job configuration for triggering build
  job:
    # Backoff limit for failed builds
    backoffLimit: 3
    # Restart policy
    restartPolicy: OnFailure
    # Service account with build permissions
    serviceAccountName: showroom-builder
