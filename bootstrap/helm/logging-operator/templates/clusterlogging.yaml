{{- if .Values.clusterLogging.enabled }}
apiVersion: observability.openshift.io/v1
kind: ClusterLogForwarder
metadata:
  name: {{ .Values.clusterLogging.name }}
  namespace: {{ .Values.clusterLogging.namespace }}
  annotations:
    argocd.argoproj.io/sync-wave: "3"
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
spec:
  managementState: Managed
  serviceAccount:
    name: {{ .Values.clusterLogging.serviceAccount.name }}
  outputs:
  - name: lokistack
    type: lokiStack
    lokiStack:
      target:
        name: {{ .Values.lokiStack.name }}
        namespace: {{ .Values.lokiStack.namespace }}
      authentication:
        token:
          from: serviceAccount
    {{- if .Values.clusterLogging.output.lokiStack.tls.enabled }}
    tls:
      ca:
        configMapName: {{ .Values.clusterLogging.output.lokiStack.tls.ca.configMapName }}
        key: {{ .Values.clusterLogging.output.lokiStack.tls.ca.key }}
    {{- end }}
  pipelines:
  - name: default
    inputRefs:
      {{- if .Values.clusterLogging.collection.logs.application.enabled }}
      - application
      {{- end }}
      {{- if .Values.clusterLogging.collection.logs.infrastructure.enabled }}
      - infrastructure
      {{- end }}
      {{- if .Values.clusterLogging.collection.logs.audit.enabled }}
      - audit
      {{- end }}
    outputRefs:
    - lokistack
{{- end }}
