{{- if .Values.clusterLogging.enabled }}
apiVersion: logging.openshift.io/v1
kind: ClusterLogging
metadata:
  name: {{ .Values.clusterLogging.name }}
  namespace: {{ .Values.clusterLogging.namespace }}
  annotations:
    argocd.argoproj.io/sync-wave: "3"
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
spec:
  # Management state
  managementState: Managed
  
  # Log collection
  collection:
    type: vector
    vector: {}
    {{- if or .Values.clusterLogging.collection.logs.application.enabled .Values.clusterLogging.collection.logs.infrastructure.enabled .Values.clusterLogging.collection.logs.audit.enabled }}
    logs:
      {{- if .Values.clusterLogging.collection.logs.application.enabled }}
      application:
        namespaceSelector:
          matchExpressions:
          - key: kubernetes.io/metadata.name
            operator: NotIn
            values:
            - openshift
            - openshift-operators
            - openshift-logging
            - openshift-monitoring
      {{- end }}
      {{- if .Values.clusterLogging.collection.logs.infrastructure.enabled }}
      infrastructure: {}
      {{- end }}
      {{- if .Values.clusterLogging.collection.logs.audit.enabled }}
      audit: {}
      {{- end }}
    {{- end }}
  
  # Log storage
  logStore:
    type: lokistack
    lokistack:
      name: {{ .Values.lokiStack.name }}
{{- end }}
