{{- if .Values.lokiStack.enabled }}
apiVersion: loki.grafana.com/v1
kind: LokiStack
metadata:
  name: {{ .Values.lokiStack.name }}
  namespace: {{ .Values.lokiStack.namespace }}
  annotations:
    argocd.argoproj.io/sync-wave: "3"
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
spec:
  size: {{ .Values.lokiStack.size }}
  storage:
    schemas:
    - version: v13
      effectiveDate: "2024-01-01"
    {{- if or (eq .Values.lokiStack.s3.type "odf") (eq .Values.lokiStack.s3.type "external") }}
    secret:
      name: {{ default (printf "%s-s3" .Values.lokiStack.name) .Values.lokiStack.s3.secretName }}
      type: s3
    {{- end }}
  storageClassName: {{ .Values.lokiStack.storageClassName }}
  tenants:
    mode: {{ .Values.lokiStack.tenantMode }}
{{- end }}
