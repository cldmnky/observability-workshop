apiVersion: perses.dev/v1alpha1
kind: PersesDashboard
metadata:
  name: sample-app-dashboard
  namespace: user1-observability-demo
  labels:
    monitoring.rhobs/stack: observability-stack
spec:
  display:
    name: Sample Application Metrics
    description: HTTP request metrics for sample-app
  duration: 1h
  datasources:
    prometheusDatasource:
      default: true
      display:
        name: Thanos Querier
        description: COO Prometheus via Thanos Querier
      plugin:
        kind: PrometheusDatasource
        spec:
          directUrl: http://thanos-querier-observability-stack.observability-demo.svc.cluster.local:10902
  panels:
    httpRequestRate:
      kind: Panel
      spec:
        display:
          name: HTTP Request Rate
          description: Requests per second by pod
        plugin:
          kind: TimeSeriesChart
          spec:
            legend:
              position: bottom
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  datasource:
                    kind: PrometheusDatasource
                    name: prometheusDatasource
                  query: sum(rate(http_requests_total{namespace="user1-observability-demo"}[5m])) by (pod)
    totalRequests:
      kind: Panel
      spec:
        display:
          name: Total HTTP Requests
          description: Cumulative request count by pod
        plugin:
          kind: TimeSeriesChart
          spec:
            legend:
              position: bottom
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  datasource:
                    kind: PrometheusDatasource
                    name: prometheusDatasource
                  query: sum(http_requests_total{namespace="user1-observability-demo"}) by (pod)
  layouts:
    - kind: Grid
      spec:
        display:
          title: Request Metrics
          collapse:
            open: true
        items:
          - x: 0
            y: 0
            width: 12
            height: 6
            content:
              $ref: '#/spec/panels/httpRequestRate'
          - x: 0
            y: 6
            width: 12
            height: 6
            content:
              $ref: '#/spec/panels/totalRequests'
